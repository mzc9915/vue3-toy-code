{
  "version": 3,
  "sources": ["../../shared/src/index.ts", "../src/effect.ts", "../src/reactiveEffect.ts", "../src/baseHandler.ts", "../src/reactive.ts", "../src/ref.ts", "../src/computed.ts", "../src/apiWatch.ts"],
  "sourcesContent": ["export const isObject = (val)=>{\n    return typeof val === 'object' && val !== null\n}\n\nexport const isFunction = (val)=>{\n    return typeof val === 'function'\n}", "import { DirtyLevels } from \"./constants\"\n\nexport const effect = (fn, options)=>{\n    // \u9ED8\u8BA4\u6267\u884Ceffect\u65F6\u4F1A\u5BF9\u5C5E\u6027\uFF0C\u8FDB\u884C\u4F9D\u8D56\u6536\u96C6\n\n    // \u521B\u5EFA\u4E00\u4E2Aeffect\uFF0C\u53EA\u8981\u4F9D\u8D56\u7684\u5C5E\u6027\u53D1\u751F\u53D8\u5316\uFF0C\u5C31\u4F1A\u91CD\u65B0\u6267\u884Ceffect\n    const _effect = new ReactiveEffect(fn, ()=>{\n        // scheduler\n        _effect.run()\n    })\n\n    if(options){\n        Object.assign(_effect, options)\n    }\n\n    _effect.run()\n\n    const runner = _effect.run.bind(_effect)\n    runner.effect = _effect\n    return runner\n}\n\nconst preCleanEffect = (effect) => {\n    effect._depsLength = 0\n    // \u6BCF\u6B21\u6267\u884Ceffect\u65F6\uFF0C\u90FD\u4F1A\u66F4\u65B0id\uFF1B\u5982\u679C\u662F\u540C\u4E00\u4E2A effect\uFF0Cid \u5C31\u662F\u76F8\u540C\u7684\n    effect._trackId++\n}\n\nconst postCleanEffect = (effect) => {\n    // [flag, xx, yy, zz] -> [flag, cc]\n\n    // \u4E3B\u8981\u901A\u8FC7\uFF1Aeffect.deps.length \u548C effect._depsLength \u6765\u7BA1\u7406\u4F9D\u8D56\n    // 0~_depsLength \u4E4B\u95F4\u7684\u624D\u662F\u6709\u6548\u7684\u4F9D\u8D56\uFF0C\u5176\u4ED6\u7684\u662F\u65E0\u6548\u7684\u4F9D\u8D56\n    if(effect.deps.length > effect._depsLength){\n        for (let i = effect._depsLength; i < effect.deps.length; i++) {\n            // \u5220\u9664\u6620\u5C04\u8868\u4E2D\u5BF9\u5E94\u7684effect\n            cleanDepEffect(effect.deps[i], effect)\n        }\n\n        // \u66F4\u65B0\u4F9D\u8D56\u5217\u8868\u7684\u957F\u5EA6\n        effect.deps.length = effect._depsLength\n    }\n}\n\nexport let activeEffect;\n\nexport class ReactiveEffect {\n    _trackId = 0 // \u7528\u4E8E\u8BB0\u5F55\u5F53\u524Deffet \u6267\u884C\u4E86\u51E0\u6B21\n    _depsLength = 0\n    _running = 0\n    _dirtyLevel = DirtyLevels.DIRTY\n    active = true\n    deps = [] // \u6536\u96C6 effect \u4E2D\u4F7F\u7528\u5230\u7684\u5C5E\u6027\n\n    // \u5982\u679Cfn\u4E2D\u4F9D\u8D56\u7684\u6570\u636E\u53D1\u751F\u53D8\u5316\u540E\uFF0C\u9700\u8981\u91CD\u65B0\u8C03\u7528 -> run()\n    constructor(public fn, public scheduler){} \n\n    get dirty(){\n        return this._dirtyLevel === DirtyLevels.DIRTY\n    }\n    set dirty(val){\n        this._dirtyLevel = val ? DirtyLevels.DIRTY : DirtyLevels.NOT_DIRTY\n    }\n\n    // vue3.4 \u548C \u4E4B\u524D\u89E3\u51B3 \u5D4C\u5957 effect \u6709\u4F55\u4E0D\u540C\n    // 1. \u4F7F\u7528\u6808\u7684\u65B9\u5F0F\u89E3\u51B3\n    // 2. \u901A\u8FC7 currentEffect \u5C5E\u6027\u89E3\u51B3\n\n    // \u6267\u884Crun\uFF0C\u4EE3\u8868\u9875\u9762\u91CD\u65B0\u6E32\u67D3\n    run(){\n        // \u6BCF\u6B21\u8FD0\u884C\u540E\uFF0C\u8BA9effect \u7684 dirty NO_DIRTY\n        this._dirtyLevel = DirtyLevels.NOT_DIRTY\n\n        if(!this.active){\n            return this.fn()\n        }\n\n        const currentEffect = activeEffect\n        \n        try{\n            activeEffect = this\n\n            // effect \u91CD\u65B0\u6267\u884C\u524D\uFF0C\u9700\u8981\u6E05\u9664\u4E0A\u4E00\u6B21\u7684\u4F9D\u8D56\n            preCleanEffect(this)\n            this._running++;\n            // \u8FDB\u884C\u4F9D\u8D56\u6536\u96C6\u5DE5\u4F5C\n            return this.fn()\n        }finally{\n            this._running--;\n            postCleanEffect(this)\n            activeEffect = currentEffect\n        }\n    }\n\n    stop() {\n        if (this.active) {\n          this.active = false; // \u540E\u7EED\u6765\u5B9E\u73B0\n          preCleanEffect(this);\n          postCleanEffect(this);\n        }\n      }\n}\n\nconst cleanDepEffect = (dep, effect)=>{\n    dep.delete(effect)\n    if(dep.size === 0){\n        // \u5982\u679Cmap\u4E3A\u7A7A\uFF0C\u5219\u5220\u9664\u8FD9\u4E2A\u5C5E\u6027\n        dep.cleanup()\n    }\n}\n\n// effect \u548C dep \u53CC\u5411\u8BB0\u5FC6\nexport const trackEffect = (effect, dep) => {\n    /**\n     * \u5B58\u5728\u6536\u96C6\u591A\u4F59\u4F9D\u8D56\u7684\u95EE\u9898\n     *  dep.set(effect, effect._trackId)\n     *  effect.deps[effect._depsLength++] = dep\n     */\n\n    // \u4F9D\u8D56\u6536\u96C6\u65F6\uFF0C\u662F\u4E00\u4E2A\u4E00\u4E2A\u8FDB\u884C\u6536\u96C6\u7684\uFF0C\u5728\u91CD\u65B0\u6536\u96C6\u65F6\uFF0C\u9700\u8981\u5C06\u4E0D\u8981\u7684\u4F9D\u8D56\u79FB\u9664\u6389\n    // 1. _trackId \u8BB0\u5F55\u6267\u884C\u6B21\u6570\uFF0C \u7528\u4E8E\u6807\u8BC6effect\u662F\u5426\u5DF2\u7ECF\u6536\u96C6\u8FC7\u4F9D\u8D56\uFF0C\u9632\u6B62\u4E00\u4E2A\u5C5E\u6027\u5728\u5F53\u524Deffect\u4E2D\u91CD\u590D\u6536\u96C6\uFF0C\u4E00\u4E2A\u5C5E\u6027\u5728\u4E00\u4E2Aeffect\u4E2D\u53EA\u6536\u96C6\u4E00\u6B21\n    // \u6E05\u7406\u64CD\u4F5C\u662F\u5728 effect \u7684 run \u65B9\u6CD5\u4E2D\u8FDB\u884C\u7684\uFF0C\u6240\u4EE5\uFF0C\u4E00\u4E2A effect \u5728 \u540C\u4E00\u4E2A\u6267\u884C\u8FC7\u7A0B\u4E2D\uFF0C _trackId\u662F\u76F8\u540C\u7684\n    if(dep.get(effect) !== effect._trackId){\n        // \u66F4\u65B0id\n        dep.set(effect, effect._trackId)\n\n        let oldDep = effect.deps[effect._depsLength]\n\n        if(oldDep !== dep){\n            if(oldDep){\n                // \u5220\u9664\u8001\u7684\u4F9D\u8D56\n                cleanDepEffect(oldDep, effect)\n            }\n\n            // \u66FF\u6362\u6210\u65B0\u7684\u4F9D\u8D56\n            effect.deps[effect._depsLength++] = dep\n        }else{\n            effect._depsLength++\n        }\n    }\n\n    // if(dep.get(effect) !== effect._trackId){\n    //     // \u66F4\u65B0id\n    //     dep.set(effect, effect._trackId)\n\n\n    // }\n}\n\nexport const triggerEffects = (dep) => {\n    for(const effect of dep.keys()){\n        // \u5C5E\u6027\u4F9D\u8D56\u4E86\u8BA1\u7B97\u5C5E\u6027\uFF0C\u9700\u8981\u8BA9\u8BA1\u7B97\u5C5E\u6027\u7684dirty\u53D8\u4E3Atrue\n        if(effect._dirtyLevel < DirtyLevels.DIRTY){\n            effect._dirtyLevel = DirtyLevels.DIRTY\n        }\n\n        if(!effect._running){\n            if(effect.scheduler){\n                effect.scheduler()\n            }\n        }\n    }\n}", "import { activeEffect, trackEffect, triggerEffects } from \"./effect\"\n\n// \u5B58\u653E\u4F9D\u8D56\u6536\u96C6\u7684\u5173\u7CFB\nconst targetMap = new WeakMap()\n\nexport const createDep = (cleanup, key)=>{\n    const dep = new Map() as any\n    // \u7528\u4E8E\u6E05\u7406\u4E0D\u9700\u8981\u7684\u5C5E\u6027\n    dep.cleanup = cleanup\n    dep._name = key; // \u81EA\u5B9A\u4E49\u7684\u4E3A\u4E86\u6807\u8BC6\u8FD9\u4E2A\u6620\u5C04\u8868\u662F\u7ED9\u54EA\u4E2A\u5C5E\u6027\u670D\u52A1\u7684\n    return dep\n}\n\nexport const track = (target, key)=>{\n    // activeEffect \u6709\u8FD9\u4E2A\u5C5E\u6027 \u8BF4\u660E\u8FD9\u4E2Akey\u662F\u5728effect\u4E2D\u8BBF\u95EE\u7684\uFF0C\u6CA1\u6709\u8BF4\u660E\u5728effect\u4E4B\u5916\u8BBF\u95EE\u7684\u4E0D\u7528\u8FDB\u884C\u6536\u96C6\n    if(activeEffect){\n        // \u6784\u5EFA\u6570\u636E\u7ED3\u6784\uFF1AMap: {obj: {\u5C5E\u6027\uFF1ASet:[effect,effect,effect]}}\n        let depsMap = targetMap.get(target)\n\n        if(!depsMap){\n            targetMap.set(target, (depsMap = new Map()))\n        }\n\n        let dep = depsMap.get(key)\n\n        if(!dep){\n            depsMap.set(\n                key,\n                (dep = createDep(()=>depsMap.delete(key), key))\n            )\n        }\n\n        // \u4F9D\u8D56\u6536\u96C6\n        trackEffect(activeEffect, dep)\n    }\n}\n\n\nexport const trigger = (target, key, newVal, oldVal)=>{\n    const depsMap = targetMap.get(target)\n\n    if(!depsMap){\n        // \u627E\u4E0D\u5230\u5BF9\u8C61\uFF0C\u76F4\u63A5 return\n        return;\n    }\n\n    let dep = depsMap.get(key)\n\n    if(dep){\n        triggerEffects(dep)\n    }\n}\n", "import { isObject } from \"@vue/shared\"\nimport { ReactiveFlags } from \"./constants\"\nimport { reactive } from \"./reactive\"\nimport { track, trigger } from \"./reactiveEffect\"\n\nexport const mutableHandlers = {\n    // Reflect \u63D0\u4F9B\u7684\u65B9\u6CD5\u53EF\u5E2E\u52A9\u6211\u4EEC\u907F\u514D\u5728 Proxy handler \u4E2D\u76F4\u63A5\u5BF9\u76EE\u6807\u5BF9\u8C61\u8FDB\u884C\u64CD\u4F5C\uFF0C\u4ECE\u800C\u51CF\u5C11\u6F5C\u5728\u7684\u9519\u8BEF\u548C\u4EE3\u7801\u590D\u6742\u5EA6\n    get(target, key, recevier){\n        if(key === ReactiveFlags.IS_REACTIVE){\n            return true\n        }\n\n        // \u5F53\u53D6\u503C\u65F6\uFF0C\u8BA9\u54CD\u5E94\u5F0F\u5C5E\u6027 \u548C effect \u6620\u5C04\u8D77\u6765\n        track(target, key)\n\n        let res = Reflect.get(target, key, recevier)\n\n        if(isObject(res)){\n            return reactive(res)\n        }\n\n        return res\n    },\n    set(target, key, value, recevier){\n        let oldVal = target[key]\n\n        // \u627E\u5230\u5C5E\u6027\uFF0C\u8BA9\u5BF9\u5E94\u7684 effect \u91CD\u65B0\u6267\u884C\n        let result = Reflect.set(target, key, value, recevier)\n\n        if(oldVal !== value){\n            trigger(target, key, value, oldVal)\n        }\n\n        return result\n    }\n}", "import { isObject } from \"@vue/shared\";\nimport { ReactiveFlags } from \"./constants\";\nimport { mutableHandlers } from \"./baseHandler\";\n\nconst reactiveMap = new WeakMap();\n\nfunction createReactiveObject(target) {\n  // \u7EDF\u4E00\u505A\u5224\u65AD\uFF0C\u54CD\u5E94\u5F0F\u5BF9\u8C61\u5FC5\u987B\u662F\u5BF9\u8C61\u624D\u53EF\u4EE5\n  if (!isObject(target)) {\n    return target;\n  }\n\n  if (target[ReactiveFlags.IS_REACTIVE]) {\n    return target;\n  }\n\n  const existingProxy = reactiveMap.get(target);\n  if (existingProxy) {\n    return existingProxy;\n  }\n\n  let proxy = new Proxy(target, mutableHandlers);\n  reactiveMap.set(target, proxy);\n  return proxy;\n}\n\nexport const reactive = (target) => {\n  return createReactiveObject(target);\n};\n\nexport const toReactive = (value) => {\n  return isObject(value) ? reactive(value) : value;\n};\n\nexport function isReactive(value) {\n  return !!(value && value[ReactiveFlags.IS_REACTIVE]);\n}\n", "import { activeEffect, trackEffect, triggerEffects } from \"./effect\";\nimport { toReactive } from \"./reactive\";\nimport { createDep } from \"./reactiveEffect\";\n\nfunction createRef(rawValue, shallow = false) {\n    return new RefImpl(rawValue, shallow);\n}\n\nexport function ref(value){\n    return createRef(value);\n}\n\nexport function shallowRef(){\n\n}\n\nclass RefImpl {\n    public _value; // \u7528\u6765\u4FDD\u5B58ref \u7684\u503C\n    public _v_isRef = true; // \u589E\u52A0ref\u6807\u8BC6\n    public dep; // \u7528\u4E8E\u6536\u96C6\u5BF9\u5E94\u7684 effect\n\n    constructor(public rawValue, public _shallow){\n        this._value = _shallow ? rawValue : toReactive(rawValue)\n    }\n\n    get value(){\n        console.log('get value');\n        trackRefValue(this)\n        return this._value\n    }\n    set value(newVal){\n        if(newVal !== this.rawValue){\n            this.rawValue = newVal\n            this._value = this._shallow ? newVal : toReactive(newVal)\n            triggerRefValue(this)\n        }\n    }\n}\n\n\nexport const trackRefValue = (ref)=>{\n    if(activeEffect){\n        trackEffect(\n            activeEffect,\n            ref.dep = ref.dep || createDep(()=>ref.dep = undefined, 'undefined')\n        )\n    }\n}\n\nexport const triggerRefValue = (ref)=>{\n    debugger\n    let dep = ref.dep\n\n    if(dep){\n        // \u89E6\u53D1\u4F9D\u8D56\u66F4\u65B0\n        triggerEffects(dep)\n    }\n}\n\nclass ObjectRefImpl {\n    public _v_isRef = true\n\n    constructor(public _object, public key){}\n\n    get value(){\n        console.log(this._object, this.key);\n        return this._object[this.key]\n    }\n    set value(newVal){\n        this._object[this.key] = newVal\n    }\n}\n\nexport const toRef = (object, key)=>{\n    return new ObjectRefImpl(object, key)\n}\n\nexport const toRefs = (object)=>{\n    const res = {}\n\n    for(const key in object){\n        res[key] = new ObjectRefImpl(object, key)\n    }\n\n    return res\n}\n\nexport const proxyRefs = (objectWithRef)=>{\n    return new Proxy(objectWithRef, {\n        get(target, key, receiver){\n            let r = Reflect.get(target, key, receiver)\n            return r._v_isRef ? r.value : r\n        },\n        set(target, key, value, reciever){\n            const oldVal = target[key]\n            if(oldVal._v_isRef){\n                oldVal.value = value\n                return true\n            }else{\n                return Reflect.set(target, key, value, reciever)\n            }\n        }\n    })\n}\n\nexport function isRef(value) {\n    return value && value.__v_isRef;\n  }", "import { isFunction } from \"@vue/shared\"\nimport { ReactiveEffect } from \"./effect\";\nimport { trackRefValue, triggerRefValue } from \"./ref\";\n\nclass ComputedRefImpl {\n    public _value;\n    public effect;\n    public dep;\n    constructor(getter, public setter){\n        this.effect = new ReactiveEffect(\n            // \u7528\u6237\u7684 fn\uFF0C\u8FD9\u91CC\u5C31\u662F\uFF1A\u8BBF\u95EE \u5404\u4E2A\u54CD\u5E94\u5F0F\u5C5E\u6027\n            ()=> getter(),\n            ()=> {\n                // \u8BA1\u7B97\u5C5E\u6027\u4F9D\u8D56\u7684\u503C\u53D8\u5316\u4E86\uFF0C\u5E94\u8BE5\u89E6\u53D1effect\u91CD\u65B0\u6267\u884C\uFF0C\u5E76\u628A dirty \u53D8\u4E3Atrue\n                triggerRefValue(this)\n            }\n        )\n    }\n\n    get value(){\n        // \u9700\u8981\u6536\u96C6\u5F53\u524D\u8BA1\u7B97\u5C5E\u6027\u5BF9\u5E94\u7684effect\n        if(this.effect.dirty){\n            // \u9ED8\u8BA4\u53D6\u503C\u4E00\u5B9A\u662F\u810F\u7684\uFF0C\u6267\u884C\u4E00\u6B21 run \u5C31\u4E0D\u810F\u4E86\n            // computed \u7684 run \u65B9\u6CD5\uFF0C\u4F1A\u6267\u884C fn: ()=> getter(),\u8FD9\u4E2A\u65B9\u6CD5\u91CC\u53EF\u80FD\u5C31\u4F1A\u8BBF\u95EE\u5230 \u5176\u4ED6\u7684\u54CD\u5E94\u5F0F\u5C5E\u6027\uFF0C\n            //   \u8FDB\u800C\u8BBF\u95EE\u5C5E\u6027\u65F6\uFF0C\u4F1A\u5C06 computed\u81EA\u8EAB\u7684effect \u8FDB\u884C\u6536\u96C6\n            this._value = this.effect.run()\n\n            // \u6536\u96C6 \u7528\u5230\u5F53\u524D\u8BA1\u7B97\u5C5E\u6027\u7684 effect\n            trackRefValue(this)\n        }\n\n        return this._value\n    }\n    set value(val){\n        this.setter(val)\n    }\n}\n\n/**\n * \u63CF\u8FF0\u5B9E\u73B0\u539F\u7406\uFF1A\n *  1.\u8BA1\u7B97\u5C5E\u6027\u7EF4\u62A4\u4E86\u4E00\u4E2Adirty\u5C5E\u6027\uFF0C\u9ED8\u8BA4\u5C31\u662Ftrue\uFF0C\u7A0D\u540E\u8FD0\u884C\u8FC7\u4E00\u6B21\u4F1A\u5C06dirty\u53D8\u4E3Afalse\uFF0C\u5E76\u4E14\u7A0D\u540E\u4F9D\u8D56\u7684\u503C\u53D8\u5316\u540E\u4F1A\u518D\u6B21\u8BA9dirty\u53D8\u4E3Atrue\n *  2.\u8BA1\u7B97\u5C5E\u6027\u4E5F\u662F\u4E00\u4E2Aeffect\uFF0C\u4F9D\u8D56\u7684\u5C5E\u6027\u4F1A\u6536\u96C6\u8FD9\u4E2A\u8BA1\u7B97\u5C5E\u6027\uFF0C\u5F53\u524D\u503C\u53D8\u5316\u540E\uFF0C\u4F1A\u8BA9computedEffect\u91CC\u9762dirty \u53D8\u4E3Atrue\n *  3.\u8BA1\u7B97\u5C5E\u6027\u5177\u5907\u6536\u96C6\u80FD\u529B\u7684\uFF0C\u53EF\u4EE5\u6536\u96C6\u5BF9\u5E94\u7684effect\uFF0C\u4F9D\u8D56\u7684\u503C\u53D8\u5316\u540E\u4F1A\u89E6\u53D1effect\u91CD\u65B0\u6267\u884C\n * \n * \u8BA1\u7B97\u5C5E\u6027aLiasName\uFF0C\u8BA1\u7B97\u5C5E\u6027\u4F9D\u8D56\u7684\u503Cname\n *  - \u8BA1\u7B97\u5C5E\u6027\u672C\u8EAB\u5C31\u662F\u4E00\u4E2A effect \uFF0C\u6709\u4E00\u4E2A\u6807\u8BC6dirty = true\uFF0C\u8BBF\u95EE\u7684\u65F6\u5019\u4F1A\uFF0C\u89E6\u53D1name\u5C5E\u6027\u7684get\u65B9\u6CD5\uFF08\u4F9D\u8D56\u6536\u96C6\uFF09 \n *          \u5C06name\u5C5E\u6027\u548C\u8BA1\u7B97\u5C5E\u6027\u505A\u4E00\u4E2A\u6620\u5C04\uFF0C\u7A0D\u540Ename\u53D8\u5316\u540E\u4F1A\u89E6\u53D1\u8BA1\u7B97\u5C5E\u6027\u7684scheduler\n *  - \u8BA1\u7B97\u5C5E\u6027\u53EF\u80FD\u5728effect\u4E2D\u4F7F\u7528\uFF0C\u5F53\u53D6\u8BA1\u7B97\u5C5E\u6027\u7684\u65F6\u5019\uFF0C\n *          \u4F1A\u5BF9\u5F53\u524D\u7684effect\u8FDB\u884C\u4F9D\u8D56\u6536\u96C6\u5982\u679Cname\u5C5E\u6027\u53D8\u5316\u4E86\uFF0C\u4F1A\u901A\u77E5\u8BA1\u7B97\u5C5E\u6027\u5C06dirty \u53D8\u4E3AtrueK\u89E6\u53D1\u8BA1\u7B97\u5C5E\u6027\u6536\u96C6\u7684effect\uFF09\n */\n\nexport const computed = (getterOrOptions) => {\n    let onlyGetter = isFunction(getterOrOptions)\n\n    let getter;\n    let setter;\n\n    if(onlyGetter){\n        getter = getterOrOptions\n        setter = ()=>{}\n    }else{\n        getter = getterOrOptions.get\n        setter = getterOrOptions.set\n    }\n\n    // \u8BA1\u7B97\u5C5E\u6027ref\n    return new ComputedRefImpl(getter, setter)\n}", "import { isFunction, isObject } from \"@vue/shared\"\nimport { isReactive } from \"./reactive\"\nimport { isRef } from \"./ref\"\nimport { ReactiveEffect } from \"./effect\"\n\nexport const watch = (source, cb, options = {} as any) => {\n    return doWatch(source, cb, options)\n}\n\nexport const watchEffect = (source, options = {}) => {\n    return doWatch(source, null, options as any)\n}\n\n// \u63A7\u5236 depth \u5DF2\u7ECF\u5F53\u524D\u904D\u5386\u5230\u4E86\u90A3\u4E00\u5C42\n// seen \u7528\u6765\u8BB0\u5F55\u5DF2\u7ECF\u904D\u5386\u8FC7\u7684\u5BF9\u8C61\uFF0C\u907F\u514D\u5FAA\u73AF\u5F15\u7528\nfunction traverse(source, depth, currentDepth = 0, seen = new Set()) {\n    if(!isObject(source)){\n        return source\n    }\n\n    if(depth){\n        if(currentDepth >= depth){\n            return source\n        }\n        // \u6839\u636E deep \u5C5E\u6027\u6765\u770B\u662F\u5426\u662F\u6DF1\u5EA6\n        currentDepth++\n    }\n\n    if(seen.has(source)){\n        return source\n    }\n\n    for (const key in source) {\n        traverse(source[key], depth, currentDepth, seen)\n    }\n\n    return source\n}\n\nconst reactiveGetter = (source, deep) => {\n    const depth = deep === false ? 1 : undefined\n    traverse(source, depth)\n}\n\nfunction doWatch(source, cb, { deep = false, immediate }) {\n    debugger\n    // watch \u7684\u6838\u5FC3\u5C31\u662F\u89C2\u6D4B\u4E00\u4E2A\u54CD\u5E94\u5F0F\u6570\u636E\uFF0C\u5F53\u6570\u636E\u53D8\u5316\u65F6\u901A\u77E5\u5E76\u6267\u884C\u56DE\u8C03 \uFF08\u90A3\u4E5F\u5C31\u662F\u8BF4\u5B83\u672C\u8EAB\u5C31\u662F\u4E00\u4E2A effect\uFF09\n\n    let oldValue;\n    let getter\n    // 1. Ref\uFF1A\u901A\u8FC7\u00A0`ref`\u00A0\u521B\u5EFA\u7684\u54CD\u5E94\u5F0F\u53D8\u91CF\u3002\n    // 2. Reactive Object\uFF1A\u901A\u8FC7\u00A0`reactive`\u00A0\u521B\u5EFA\u7684\u54CD\u5E94\u5F0F\u5BF9\u8C61\u3002\n    // 3. Computed Ref\uFF1A\u901A\u8FC7\u00A0`computed`\u00A0\u521B\u5EFA\u7684\u8BA1\u7B97\u5C5E\u6027\u3002\n    // 4. Array of Refs\uFF1A\u4E00\u4E2A\u5305\u542B\u591A\u4E2A\u00A0`ref`\u00A0\u7684\u6570\u7EC4\u3002\n    // 5. Getter Function\uFF1A\u4E00\u4E2A\u8FD4\u56DE\u503C\u7684\u51FD\u6570\u3002\n    if(isReactive(source)) {\n        getter = () => reactiveGetter(source, deep)\n    }else if(isRef(source)){\n        getter = () => source.value\n    }else if(isFunction(source)){\n        getter = source\n    }\n\n    let clean;\n    const onCleanup = (fn) => {\n        clean = () => {\n            fn()\n            clean = undefined\n        }\n    }\n\n    const job = () => {\n        // \u6267\u884C effect.run() \u65F6\uFF0C\u4F1A\u89E6\u53D1 getter \u51FD\u6570, getter \u51FD\u6570\u4F1A\u89E6\u53D1\u4F9D\u8D56\u6536\u96C6\n        if(cb){\n            const newValue = effect.run()\n\n            //  \u5728\u6267\u884C\u56DE\u8C03\u524D\uFF0C\u5148\u8C03\u7528\u4E0A\u4E00\u6B21\u7684\u6E05\u7406\u64CD\u4F5C\u8FDB\u884C\u6E05\u7406\n            if(clean){\n                clean()\n            }\n\n            cb(newValue, oldValue, onCleanup)\n            oldValue = newValue\n        }else{\n            effect.run() // watchEffect\n        }\n    }\n\n    const effect = new ReactiveEffect(getter, job)\n\n    if(cb){\n        if(immediate){\n            // \u7ACB\u5373\u5148\u6267\u884C\u4E00\u6B21\u7528\u6237\u7684\u56DE\u8C03\uFF0C\u4F20\u9012\u65B0\u503C\u548C\u8001\u503C\n            job()\n        }else{\n            oldValue = effect.run()\n        }\n    }else{\n        // \u6CA1\u6709cb \u5C31 \u76F4\u63A5\u6267\u884C\u5373\u53EF\uFF0C\u8FD9\u4E5F\u5C31\u662F watchEffect\n        effect.run()\n    }\n\n    const unwatch = () => {\n        effect.stop()\n    }\n\n    return unwatch\n}"],
  "mappings": "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",
  "names": ["effect", "ref", "effect"]
}
